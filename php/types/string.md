# string

## 문자열과 중괄호

PHP에서 문자열, 중괄호 사용, 그리고 빈 문자열 대입과 관련된 동작을 상세히 설명해드리겠습니다. 이 주제는 PHP의 내부 동작과 밀접하게 연관되어 있어 매우 흥미롭습니다.

- PHP 7.4 이상에서는 중괄호를 사용한 문자열 접근이 권장되지 않습니다.
- 문자열 조작 시 인코딩(UTF-8 등)을 고려해야 합니다. 멀티바이트 문자의 경우 `mb_*` 함수를 사용하는 것이 안전합니다.

### 1. PHP의 문자열 처리

PHP에서 문자열은 바이트의 시퀀스로 처리됩니다. 이는 문자열의 각 "문자"가 실제로는 하나의 바이트를 나타낸다는 것을 의미합니다.

- 문자열은 0부터 시작하는 인덱스를 가집니다.
- 각 바이트는 0에서 255 사이의 값을 가질 수 있습니다.

예시:

```php
$str = "Hello";
echo $str[1]; // 출력: H
echo ord($str[1]); // 출력: 72 (ASCII 코드)
```

### 2. 중괄호를 사용한 문자열 접근

PHP에서는 전통적으로 문자열의 특정 위치에 접근하기 위해 중괄호(`{}`)를 사용할 수 있었습니다.

```php
$str = "Hello";
echo $str{0}; // 출력: H (PHP 7.4 이전 버전에서)
```

그러나 이 방식은 PHP 7.4에서 deprecated되었고, PHP 8.0에서 완전히 제거되었습니다. 현재는 대괄호(`[]`)를 사용하는 것이 권장됩니다.

### 3. 빈 문자열 대입과 Null 바이트

PHP에서 문자열의 특정 위치에 빈 문자열(`""`)을 대입하려고 할 때, 흥미로운 동작이 발생합니다:

```php
$str = "Hello";
$str[1] = "";
echo bin2hex($str); // 출력: 00656c6c6f
```

이 경우, PHP는 빈 문자열을 null 바이트(`\000` 또는 16진수로 `00`)로 해석합니다. 이는 다음과 같은 이유 때문입니다:

1. PHP의 문자열은 고정된 길이를 유지하려는 경향이 있습니다.
2. 각 위치에는 반드시 하나의 바이트가 있어야 합니다.
3. 빈 문자열을 대입할 때, PHP는 이를 "아무것도 없음"을 나타내는 null 바이트로 해석합니다.

### 4. Null 바이트(`\000`)의 특성

Null 바이트(`\000`)는 다음과 같은 특성을 가집니다:

- ASCII 코드 0을 나타냅니다.
- 문자열 내에서 보이지 않는 문자입니다.
- `var_dump()`나 `bin2hex()` 함수를 사용하면 확인할 수 있습니다.

```php
$str = "Hello";
$str[1] = "";
var_dump($str); // string(5) "\000ello"
echo bin2hex($str); // 00656c6c6f
```

### 5. 실제 문자 제거 방법

문자열에서 실제로 문자를 제거하려면 다음과 같은 방법을 사용해야 합니다:

1. `substr_replace()` 사용:

   ```php
   $str = "Hello";
   $str = substr_replace($str, '', 0, 1);
   echo $str; // 출력: ello
   ```

2. `substr()` 사용:

   ```php
   $str = "Hello";
   $str = substr($str, 1);
   echo $str; // 출력: ello
   ```

PHP의 문자열 처리 방식, 특히 빈 문자열 대입 시 null 바이트로 해석되는 현상은 PHP의 내부 구현과 관련이 있습니다. 이는 문자열의 일관성과 성능을 유지하기 위한 설계 결정의 결과입니다. 실제 개발 시에는 이러한 특성을 이해하고, 적절한 문자열 조작 함수를 사용하여 원하는 결과를 얻는 것이 중요합니다.

Citations:

## 중괄호 사용해서 빈 문자로 치환 가능할지? 안된다

PHP에서 문자열의 특정 위치에 빈 문자열을 대입하는 것은 해당 위치의 문자를 제거하는 것이 아니라 *null 바이트로 대체*하는 것입니다.
문자를 완전히 제거하려면 `substr_replace()`, `substr()`, 또는 정규 표현식과 같은 다른 방법을 사용해야 합니다.

이러한 동작은 PHP의 내부 문자열 처리 메커니즘과 관련이 있으며, 문자열의 일관성과 성능을 유지하기 위한 설계 결정의 결과입니다.

```php
$tmp = "'test'"; // 6개의 문자로 구성된 문자열입니다.

$tmp{0} = ""; // 문자열의 첫 번째 문자를 빈 문자열로 대체하려고 시도

var_dump($tmp);
// string(6) "\000test'" // 첫 번째 문자가 null 바이트(`\000`)로 대체
```

1. PHP의 문자열 처리:
   - PHP에서 문자열은 바이트의 시퀀스로 처리됩니다.
   - 문자열의 각 위치에는 반드시 하나의 바이트가 있어야 합니다.

2. 빈 문자열 대입의 동작:
   - 빈 문자열(`""`)을 대입하려고 할 때, PHP는 이를 null 바이트(`\000`)로 해석합니다.
   - 이는 문자열의 길이를 유지하면서 해당 위치의 문자를 "비우는" 방식입니다.

3. 문자열 길이 유지:
   - PHP는 이 연산에서 문자열의 길이를 변경하지 않습니다.
   - 대신, 지정된 위치의 문자를 null 바이트로 대체합니다.

문자열에서 특정 문자를 완전히 제거하려면 다른 방법을 사용해야 합니다:

1. `substr_replace()` 함수 사용:

   ```php
   $tmp = substr_replace($tmp, '', 0, 1);
   ```

2. `substr()` 함수 사용:

   ```php
   $tmp = substr($tmp, 1);
   ```

3. 정규 표현식 사용:

   ```php
   $tmp = preg_replace('/^./', '', $tmp);
   ```

- PHP 7.4 이후로 문자열 오프셋에 대한 중괄호(`{}`) 사용은 더 이상 권장되지 않습니다.
- 대신 대괄호(`[]`)를 사용하는 것이 좋습니다: `$tmp[1] = "";`
