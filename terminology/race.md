# race

## race(경합)이란?

## 데이터 경합(Data Race)

데이터 경합은 두 개 이상의 연산이 동시에 같은 메모리 위치에 접근할 때 발생하며, 최소한 하나의 연산이 쓰기 연산일 경우에 발생합니다. 이러한 연산들이 충돌 없이 실행 순서에 대한 명확한 조정이나 동기화 없이 메모리 위치에 접근하려 할 때 데이터 경합이 발생합니다. 데이터 경합이 발생하면 프로그램의 실행 결과는 예측 불가능하게 되며, 이로 인해 프로그램이 잘못된 데이터를 생성하거나 예기치 않은 동작을 할 수 있습니다.

**예시:** 두 스레드가 동일한 전역 변수에 접근하여 값을 증가시키려고 하는 경우, 각 스레드는 변수의 값을 읽고, 값을 증가시킨 후, 증가된 값을 다시 변수에 쓰게 됩니다. 이 과정에서 하나의 스레드가 변수의 값을 읽고 증가시키는 사이에 다른 스레드가 값을 읽어가서 증가시키면, 두 번의 증가 연산에도 불구하고 변수 값이 실제로는 한 번만 증가할 수 있습니다. 이는 쓰기 연산이 동시에 발생하는 데이터 경합의 전형적인 예입니다.

## 경합 상태(Race Condition)

경합 상태는 시스템의 실행 순서나 타이밍이 결과에 영향을 미치는 상황을 설명할 때 사용되는 용어입니다. 경합 상태는 여러 개의 스레드나 프로세스가 공유 자원에 대해 동시에 접근하려 할 때 발생할 수 있으며, 이러한 접근이 적절하게 동기화되지 않으면 예상치 못한 결과를 초래할 수 있습니다. 경합 상태는 데이터 경합과는 다르게 반드시 메모리에 대한 직접적인 접근이 포함되지 않아도 발생할 수 있습니다.

**예시:** 웹 서버가 동시에 여러 요청을 처리하는 경우, 각 요청에 대한 처리 결과를 하나의 로그 파일에 순서대로 기록해야 한다고 가정해 봅시다. 여러 스레드가 동시에 로그 파일에 쓰기를 시도하면, 파일 쓰기 순서가 예측 불가능해질 수 있습니다. 이 경우, 로그의 순서가 뒤바뀌어 기록되는 것이 경합 상태의 예가 될 수 있습니다. 이러한 상황에서는 데이터 경합이 직접적으로 발생하지 않지만, 자원에 대한 접근 순서가 중요한 역할을 합니다.

## 데이터 경합과 경합 상태의 차이점

- **정의와 초점:** 데이터 경합은 동시에 동일한 메모리 위치에 접근하는 연산들 사이의 충돌에 초점을 맞추고 있습니다. 반면, 경합 상태는 시스템의 타이밍이나 실행 순서에 따라 달라지는 조건에 초점을 맞춥니다.
- **발생 조건:** 데이터 경합은 메모리 접근과 관련 있으며, 최소한 하나의 연산이 쓰기 연산일 때 발생합니다. 경합 상태는 공유 자원의 접근 순서에 따라 발생하며, 반드시 메모리 접근이 포함될 필요는 없습니다.
- **해결 방법:** 데이터 경합은 동기화 메커니즘(예: 뮤텍스, 세마포어)을 통해 메모리 접근을 제어함으로써 해결할 수 있습니다. 경합 상태는 자원에 대한 접근 순서를 제어하거나 동기화하여 해결할 수 있습니다.

이 두 문제는 동시성 프로그래밍의 복잡성을 잘 보여주며, 올바른 동기화 메커니즘의 사용을 통해 해결할 수 있습니다.
