# Plug'n'Play(PnP)

## Plug'n'Play(PnP)

Plug'n'Play(PnP)는 JavaScript 패키지 관리 시스템에서 사용되는 방식으로, Yarn에서 도입되었고 후에 pnpm에서도 채택되었습니다.
주요 목적은 의존성 관리를 더 효율적이고 신뢰할 수 있게 만드는 것입니다.

## Plug'n'Play 특징

1. `node_modules` 폴더에 모든 패키지를 물리적으로 설치하는 대신 의존성 트리를 명시적으로 정의하는 단일 파일 사용합니다. 물리적 파일 복사 대신 의존성 매핑만 생성하므로 설치가 매우 빠릅니다.
2. 모든 의존성 정보가 단일 파일에 집중되어 있어, 의존성 해결이 더 빠르고 정확합니다.
3. 프로젝트를 다른 환경으로 이동할 때 `node_modules`를 복사할 필요가 없어 더 쉽게 이동할 수 있습니다.
4. 모든 의존성 정보가 프로젝트 내에 포함되어 있어 오프라인 환경에서도 쉽게 개발할 수 있습니다.
5. 중복 패키지 설치를 방지하고 패키지를 물리적으로 복사하는 대신 zip 아카이브로 저장하여 디스크 사용량을 크게 줄입니다.
6. 각 모듈이 명시적으로 선언한 의존성만 접근 가능하고 명시되지 않은 의존성은 사용할 수 없습니다. 이를 통해 "유령 의존성" 문제를 해결합니다.
7. Node.js의 모듈 해석 알고리즘을 최적화하여 실행 시간 개선합니다.

이는 PHP에서 composer dump autoload 하면 `autoload_static.php`, `autoload_classmap.php`, `autoload_files.php` 등의 정적인 맵핑 파일이 생성되는 것과 유사해 보입니다.

1. 유사점:

    둘 다 중앙 집중식 맵핑 파일을 사용하여 의존성 정보를 저장하고,
    런타임에 이 맵핑 파일을 사용하여 모듈/클래스를 로드합니다.

2. 차이점:

    Composer는 주로 PHP 클래스의 오토로딩에 초점을 맞추지만,
    PnP는 전체 Node.js 모듈 시스템을 대체합니다.

    Composer는 여전히 패키지를 파일 시스템에 설치하지만,
    PnP는 패키지를 zip 아카이브로 저장합니다.

    Composer는 PHP의 기존 오토로딩 메커니즘을 활용하지만,
    PnP는 Node.js의 모듈 로딩 시스템을 직접 수정합니다.

## 기존 Node.js 패키지 관리 방식과 비교

1. 기존 방식 (node_modules):
   - 모든 의존성을 `node_modules` 디렉토리에 물리적으로 설치합니다.
   - 각 프로젝트마다 별도의 `node_modules`를 생성합니다.
   - 중첩된 `node_modules` 구조로 인한 중복 설치 및 디스크 공간 낭비가 있습니다.
   - 설치 과정이 느리고 디스크 공간을 많이 차지합니다.
   - 모듈 해석을 위해 파일 시스템을 반복적으로 탐색합니다.

2. Plug'n'Play 방식:
   - 물리적인 `node_modules` 디렉토리를 생성하지 않습니다.
   - 의존성을 zip 아카이브로 저장합니다.
   - 대신, 의존성 정보를 포함한 단일 파일(예: `.pnp.js`)을 생성합니다.
   - 이 파일은 모든 패키지의 위치와 의존성 관계를 매핑합니다.
   - Node.js가 모듈을 로드할 때 이 파일을 참조하여 필요한 패키지를 찾습니다.
   - Node.js의 모듈 해석 시스템을 직접 수정하여 최적화합니다.

## 작동 원리

1. **의존성 맵 생성**:
   - `.pnp.cjs` 또는 `.pnp.js` 파일에 전체 의존성 트리와 각 패키지의 위치 정보 저장

2. **런타임 통합**:
   - Node.js의 모듈 로딩 시스템을 수정하여 PnP 파일을 사용하도록 함

3. **패키지 접근**:
   - 필요한 패키지를 zip 아카이브에서 직접 로드

4. **캐싱 최적화**:
   - 자주 사용되는 모듈을 메모리에 캐싱하여 성능 향상

## 코드 예시

Yarn PnP를 사용하는 프로젝트의 `package.json`:

```json
{
  "name": "my-project",
  "version": "1.0.0",
  "installConfig": {
    "pnp": true
  },
  "dependencies": {
    "lodash": "^4.17.21"
  }
}
```

PnP를 사용하는 JavaScript 파일:

```javascript
// PnP 환경에서는 별도의 설정 없이 의존성을 import 할 수 있습니다.
const _ = require('lodash');

console.log(_.camelCase('hello world')); // 출력: "helloWorld"
```
