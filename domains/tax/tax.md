# Tax

- [Tax](#tax)
    - [면세공제금액](#면세공제금액)
    - [공통매입세액](#공통매입세액)
    - [안분계산](#안분계산)
    - [부가세](#부가세)
    - [외화의 경우 부가세?](#외화의-경우-부가세)
    - [Q\&A](#qa)
        - [해외 매출에 대한 부가세 신고 문의](#해외-매출에-대한-부가세-신고-문의)
    - [기타](#기타)
        - [결제 요청 데이터](#결제-요청-데이터)

## 면세공제금액

- 구성 요소
    - 공통매입세액에 관련된
    - 당해 과세기간의
    - 면세사업에 대한
    - 수입금액

## 공통매입세액

- 구성 요소
    - 부가가치세과세사업과 면세사업을 함께 영위하는 사업자가
    - 매입한 재화의 매입세액 중
    - 과세사업과 면세사업에 공통으로 사용되어 실지귀속을 구분할 수 없는

## [안분계산](https://txsi.hometax.go.kr/docs/customer/dictionary/view.jsp?word_id=6258)

- 구성요소
    - 하나의 거래가
    - 2 이상의 과세방법을 달리하는 거래에 해당되는 경우,
    - 그 거래의 금액을 일정한 방법에 따라
    - 각각의 과세방법을 달리하는 거래의 금액으로 나누어 계산하는 것

![안분계산](./resources/hometax_proportional-calculation.png)

## 부가세

과세상품만 있을때

```go
if Amount = X
부가세 = X *1/11, 공급가액 = X* 10/11
```

과세상품 금액 X,  면세상품 금액 Y

```go
if Amount = X + Y
부가세 = X *1/11,공급가액 = Y + (X* 10/11)  
```

위 상황에서 부분환불 금액 이 C 그중 면세상품 부분환불 금액이 D 일때

```go
부가세 = (C - D) *1/11, 공급가액 = D + (C - D)* 10/11
```

과세상품 금액 = X , 포인트 및 할인금액 = Z

```go
if Amount = X
부가세 = (X - Z) *1/11 , 공급가액 = (X - Z)*10/11
```

과세상품 금액 X, 면세상품 금액 Y , 포인트 및 할인 금액 Z

```go
if Amount = X + Y
부가세 = (X - Z) *1/11 , 공급가액 = Y +  (X - Z)*10/11
```

```php
/**
 * 2016-05-25 : VAT관련 최종 정리(bugfix)
 * 일반과세 MID(10%부가세 자동적용) : vat, sppl 등 파라메터를 지정하면 10%자동적용을 무시하고 파라메터를 우선 적용한다. vat파라메터가 없어도 결제 성공.
 * 복합과세 MID(파라메터 부가세 적용) : vat, sppl 파라메터 지정된 것을 그대로 적용한다. vat파라메터가 없으면 결제 실패.
 *
 * @param mixed $amount
 * @param mixed $vat
 */
private function vat_info($amount, $vat)
{
    $sppl = $vat * 10;
    // vat처리하는 방식에 따라 1원차이가 생길 수 있고, $sppl + $vat > $amount가 되는 상황을 방지
    $sppl = min($amount - $vat, $sppl);

    // [2018-10-01] 
    // 오차로 인해 1원 ~ 5원만 tax_free에 잡히는 경우 방지 (산술적으로 최대 5원 임) 
    // <=> N < A/11 < N+0.5인 경우 부가세 * 11했을 때 전체 금액대비 부족한 차액이 생겨 오차가 생김 
    // <=> 11N < A < 11N+5.5 이고 A, N은 정수이므로 A = 11N + 1,2,3,4,5 총 5가지 경우의 수가 생김
    // 
    // 이거 때문에 vat를 deprecated시키고 tax_free 쓰라고 한건데, 
    // 복합과세 설정된 MID의 경우 `tax_free: 0` 을 못주게 돼있어서
    // vat를 쓰도록 유도해야하는 경우가 생김
    $tax_free = $amount - $sppl - $vat;
    if ($tax_free >= 1 && $tax_free <= 5) {
        $sppl = $sppl + $tax_free; // tax_free 를 sppl 에 합침
        $tax_free = 0;
    }

    return [
        'supply' => $sppl,
        'vat' => $vat,
        'service' => 0,
        'tax_free' => $tax_free,
    ];
}
```

## 외화의 경우 부가세?

대한민국에서 외국 판매자의 상품을 판매할 때 공급가액, 부가세, 면세공급가액 등을 고려해야 하는 경우가 있습니다.
이는 주로 전자상거래 플랫폼이나 국내 대리인을 통해 판매할 때 발생합니다.

구체적인 상황을 살펴보겠습니다:

1. 간편 사업자 등록 제도:
   - 2019년 9월부터 시행된 이 제도에 따르면, 연간 국내 공급가액이 2억원 이상인 해외 판매자는 국내에서 부가가치세를 납부해야 합니다.
   - 이 경우 해외 판매자는 공급가액과 부가세를 구분하여 관리해야 합니다.

2. 전자상거래 플랫폼을 통한 판매:
   - 해외 판매자가 국내 전자상거래 플랫폼(예: 쿠팡 글로벌 셀링)을 통해 판매할 경우, 플랫폼에서 부가세 신고 및 납부를 대행할 수 있습니다.
   - 이 경우 판매자는 플랫폼에 공급가액을 정확히 제공해야 합니다.

3. PG사 결제 처리:
   - 일부 PG사에서는 해외 판매자의 상품에 대해 부가세를 별도로 표시하거나 처리하는 기능을 제공합니다.
   - 이 경우 판매자나 플랫폼은 PG사에 공급가액과 부가세를 구분하여 전달해야 할 수 있습니다.

4. 면세 품목:
   - 일부 상품(예: 특정 식품, 도서 등)은 부가세가 면제될 수 있습니다.
   - 이런 경우 면세공급가액으로 처리되며, 이를 별도로 관리해야 합니다.

5. 관세 및 수입세:
   - $150 이상의 상품은 관세와 부가세가 부과됩니다.
   - 이 경우 판매자나 플랫폼은 구매자에게 추가 비용이 발생할 수 있음을 안내해야 합니다.

6. 세금계산서 발행:
   - B2B 거래의 경우, 국내 사업자가 해외 판매자로부터 직접 구매할 때 세금계산서 발행이 필요할 수 있습니다.
   - 이 경우 공급가액과 부가세를 명확히 구분해야 합니다.

예시 계산:
$12.34 상품의 경우 (환율 1,300원 가정)
- 원화 금액: 16,042원
- 공급가액: 14,584원 (16,042 ÷ 1.1, 원단위 절사)
- 부가세: 1,458원 (14,584 × 0.1)

실제 구현 시 고려사항:
1. 정확한 환율 적용 (실시간 또는 일별 고정 환율)
2. 원단위 처리 방식 (절사, 반올림, 올림)
3. 부가세 계산 시 소수점 처리
4. PG사별 요구사항에 맞는 데이터 포맷 준비

결론적으로, 해외 판매자의 상품을 대한민국에서 판매할 때 공급가액, 부가세, 면세공급가액 등을 고려해야 하는 경우가 많습니다.
특히 전자상거래 플랫폼을 통해 판매하거나 국내 PG사를 이용할 때 이러한 구분이 필요할 수 있으며, 정확한 세금 처리와 규정 준수를 위해 중요합니다.

외화로 표시된 금액을 원화로 환산한 후에 공급가액과 부가세를 계산하는 것이 올바른 방법입니다.
$12.34를 직접 11로 나누는 것은 적절하지 않습니다.
올바른 과정을 단계별로 설명해 드리겠습니다:

1. 외화 금액을 원화로 환산
   - 예: $12.34 × 1,300원/$ = 16,042원

2. 환산된 원화 금액을 기준으로 공급가액과 부가세 계산
   - 공급가액: 16,042원 ÷ 1.1 = 14,583.63636...원
   - 공급가액 (원단위 절사): 14,583원
   - 부가세: 14,583원 × 0.1 = 1,458.3원
   - 부가세 (원단위 올림): 1,459원

3. 최종 금액 확인
   - 공급가액: 14,583원
   - 부가세: 1,459원
   - 총 금액: 16,042원

이 과정에서 주의할 점들:

1. 환율 적용: 실시간 환율이나 해당 일자의 기준 환율을 사용합니다.

2. 원단위 처리:
   - 공급가액은 보통 원단위 절사합니다.
   - 부가세는 원단위 올림하는 것이 일반적입니다.

3. 부가세 계산 시점:
   - 원화 환산 후에 계산합니다.

4. 반올림 오차:
   - 계산 과정에서 발생할 수 있는 반올림 오차에 주의해야 합니다.

5. 총 금액 일치:
   - 공급가액과 부가세의 합이 원래의 원화 환산 금액과 일치하는지 확인합니다.

코드로 구현한다면 다음과 같을 수 있습니다:

```php
function calculateAmounts($usdAmount, $exchangeRate) {
    $krwTotal = round($usdAmount * $exchangeRate);
    $supplyAmount = floor($krwTotal / 1.1);
    $vat = $krwTotal - $supplyAmount;

    return [
        'total' => $krwTotal,
        'supplyAmount' => $supplyAmount,
        'vat' => $vat
    ];
}

$result = calculateAmounts(12.34, 1300);
print_r($result);
```

이 방식을 사용하면 외화 금액을 정확하게 원화로 환산하고, 그 후에 공급가액과 부가세를 올바르게 계산할 수 있습니다. 직접 달러 금액을 11로 나누는 것은 환율 변동을 고려하지 않기 때문에 정확한 계산 방법이 아닙니다.

## Q&A

### [해외 매출에 대한 부가세 신고 문의](https://www.findsemusa.com/service/consult/consultView.do?qidx=15227)

안녕하세요.

초보 사업자라서 질문의 수준이 좀 낮더라도, 먼저 양해를 구하고 질문 드려봅니다.

대한민국의 정부수입인지를 외국 법인에 제공하고, 그 인지대금+수수료=매출로 하는 사업을 운영하고 있습니다.
대금은 주로 달러로 해외계좌이체나 페이팔을 통해 받습니다.
현재는 일반과세자인데, 매출이 영세하여 조만간 간이과세 전환을 생각하고 있습니다.

1. 이 경우 부가세 납부는 수수료에 대한 대금만 하면 되는 지 궁금합니다.(인지 구매비용은 영세율 적용으로 부가세 환급 등 불가)

    A: *해외 매출에 대한 부가세 납부는 일반적으로 수수료에 대해서만* 이루어집니다.
       **해외판매 대금은 제품 또는 서비스 판매와는 상관없는 매출이므로, 해당 금액에 대한 부가세는 납부할 필요가 없습니다**.

    1. 만약 부가세 납부를 전체 매출에 대해 하여야 한다면,
       예를들어 인지대금(100만)+수수료(10만)인 경우 그 10%인 11만원을 부가세로 내야한다는 것인가요?

        A:
        맞습니다. 수수료에 대해 10%의 세금을 부가세로 납부하게 됩니다.

    2. 부가세 납부 시, 기타 매출분(현금영수증, 세금계산서 발행 안한 기타 매출분)으로 신고를 하여야 하는데,
       제가 자체적으로 계산한 매출을 신고하고, 추후 만약 소명 요청이 있을 때 증빙할만한 자료만 가지고 있으면 되는 지 궁금합니다.

        A:
        부가세 신고 시, 기타 매출분에 대해서는 현금영수증, 세금계산서 발행 등의 증빙자료를 가지고 있어야 합니다.
        추후 소명 요청이 있을 경우, 신고한 매출에 대한 증빙을 제공해야 합니다.

    3. 매출 발생 시 달러를 이체 받는 데, 그 이체 받는 시점을 매출일로 잡아야 하는 지, 원화로 환전하는 시점을 매출일로 받아야 하는 지 궁금합니다.
       만약, 이체 받는 시점이 매출일이라면 그 날의 환율을 적용하여 매출로 생각하여야 하나요?

        A:
        매출일은 대금이 이체된 날짜로 잡아야 합니다.
        이체 받는 시점이 매출일이므로 해당 날짜의 환율을 적용하여 매출로 생각해야 합니다.

2. 간이과세 전환 후, 간이과세율을 적용하여 만약 1.5%의 부가세를 납부하게 된다면,
   이 경우에도 총매출(인지대금+수수료)에 대한 1.5%를 납부하여야 하는 지, 수수료에 대한 1.5%를 납부하여야 하는 지 궁금합니다.

    A:
    간이과세 전환 후에는 간이과세율에 따라 부가세를 납부하게 됩니다.
    따라서 총매출에 대한 1.5%를 납부하게 됩니다.

3. 그 외 혹시 제가 잘못 접근하고 있는 부분이 있다면, 별도의 고견 부탁 드립니다.

    A:
    위에 답변해드린 내용을 기반으로 보면 됩니다.
    다만, 정부의 규정이나 법률에 항상 최신을 유지하고 변화하는지 확인하는 것이 중요합니다. 상황에 따라서는 좀 더 상세한 사항을 확인해야 할 수도 있으므로, 필요에 따라 세무사나 회계사와 상담하는 것을 추천합니다.

## 기타

### 결제 요청 데이터

```json
{
  "channel": "mobile",
  "provider": "html5_inicis",
  "pay_method": "card",
  "amount": 250,
  "currency": "USD",
  "tax_free": 250,
  "merchant_uid": "p20774e8c293908363",
  ... 생략 ...
}
```

```json
{
  "channel": "mobile",
  "provider": "html5_inicis",
  "pay_method": "card",
  "amount": 249.99,
  "currency": "USD",
  "tax_free": 249,
  "merchant_uid": "p630298aa251420571",
  ... 생략 ...
}
```

```plaintext
imp_uid    status    currency    pg_provider    amount    vat    payment_taxfree    created    modified    paid_at
imp_111818908909    paid    USD    paypal_v2    1000        300    2024-01-08T14:13:39    2024-01-08T14:14:05    2024-01-08T14:14:05
imp_111256312667    cancelled    USD    html5_inicis    100        100    2023-12-05T14:30:56    2023-12-05T14:32:41    2023-12-05T14:31:44
imp_353558850739    paid    USD    html5_inicis    53.96        50000    2022-11-23T10:39:18    2022-11-23T10:40:43    2022-11-23T10:40:43
imp_882483528367    paid    USD    html5_inicis    135.83        50000    2022-11-23T10:21:23    2022-11-23T10:25:18    2022-11-23T10:25:18
imp_179311319599    paid    USD    html5_inicis    2        2    2022-06-21T15:51:51    2022-06-21T15:54:34    2022-06-21T15:54:34
imp_856768062255    paid    THB    html5_inicis    2873481        73547    2022-03-11T08:59:28    2022-03-11T09:03:59    2022-03-11T09:03:59
```
