# CVE-2016-1000027

- [CVE-2016-1000027](#cve-2016-1000027)
    - [취약점](#취약점)
    - [상세 설명](#상세-설명)
    - [Java 역직렬화(deserialization) 과정에서 원격 코드 실행(Remote Code Execution, RCE)](#java-역직렬화deserialization-과정에서-원격-코드-실행remote-code-execution-rce)
        - [역직렬화의 기본 과정](#역직렬화의-기본-과정)
        - [악의적 조작된 바이트 스트림](#악의적-조작된-바이트-스트림)
        - [예시: 악의적 조작된 바이트 스트림을 통한 RCE](#예시-악의적-조작된-바이트-스트림을-통한-rce)
    - [대응 방안](#대응-방안)

## 취약점

Library: org.springframework:spring-web
Version: 5.3.25
CVE: CVE-2016-1000027

Pivotal Spring Framework before 6.0.0 suffers from a potential remote code execution (RCE) issue if used for Java deserialization of untrusted data. Depending on how the library is implemented within a product, this issue may or not occur, and authentication may be required.

Maintainers recommend investigating alternative components or a potential mitigating control. Version 4.2.6 and 3.2.17 contain [enhanced documentation](https://github.com/spring-projects/spring-framework/commit/5cbe90b2cd91b866a5a9586e460f311860e11cfa) advising users to take precautions against unsafe Java deserialization, version 5.3.0 [deprecate the impacted classes](https://github.com/spring-projects/spring-framework/issues/25379) and version 6.0.0 [removed it entirely](https://github.com/spring-projects/spring-framework/issues/27422).

## 상세 설명

이 취약점(CVE-2016-1000027)은 Pivotal Spring Framework에서 Java 객체의 역직렬화(deserialization)를 처리하는 과정에서 발생하는 원격 코드 실행(Remote Code Execution, RCE) 문제와 관련이 있습니다. Java 역직렬화는 Java 객체를 바이트 시퀀스로 변환한 후, 이를 다시 원래의 객체로 복원하는 과정입니다. 이 과정은 네트워크를 통해 객체를 전송하거나 데이터를 저장할 때 유용하게 사용됩니다.

이 취약점은 Spring Framework가 신뢰할 수 없는 데이터로부터 Java 객체를 역직렬화할 때 발생합니다. 공격자가 악의적으로 조작된 데이터를 역직렬화하는 과정에 주입할 경우, 이를 통해 서버 상에서 임의의 코드를 실행할 수 있게 됩니다. 이는 공격자에게 시스템의 제어권을 넘길 수 있는 매우 심각한 보안 위협입니다.

예를 들어, 어떤 웹 애플리케이션이 사용자로부터 받은 데이터를 Java 객체로 역직렬화하여 처리하는 기능을 가지고 있다고 가정해봅시다. 이 애플리케이션은 사용자의 세션 정보를 역직렬화하여 사용자의 로그인 상태를 확인합니다. 공격자는 이 과정에 악의적으로 조작된 데이터를 주입하여, 애플리케이션 서버 상에서 공격자가 원하는 코드를 실행할 수 있습니다. 예를 들어, 공격자는 서버의 파일 시스템에 접근하여 중요한 파일을 삭제하거나, 다른 시스템으로의 공격을 위한 악성 코드를 설치할 수 있습니다.

## Java 역직렬화(deserialization) 과정에서 원격 코드 실행(Remote Code Execution, RCE)

악의적으로 조작된 바이트 스트림을 역직렬화하는 과정에서 발생한다

### 역직렬화의 기본 과정

Java에서 객체를 바이트 스트림으로 변환하고 이를 다시 객체로 복원하는 과정은 직렬화(serialization)와 역직렬화(deserialization)라고 합니다. 이 과정은 객체의 상태를 바이트 시퀀스로 변환하고, 이 바이트 시퀀스를 다시 객체로 복원하는 것을 포함합니다. 이는 네트워크를 통해 객체를 전송하거나 데이터를 저장할 때 유용하게 사용됩니다.

### 악의적 조작된 바이트 스트림

악의적 조작된 바이트 스트림은 일반적으로 공격자가 생성하며, 이는 역직렬화 과정에서 실행될 수 있는 코드를 포함할 수 있습니다. 예를 들어, 공격자는 애플리케이션에 악의적 조작된 바이트 스트림을 전송하고, 이를 역직렬화하는 과정에서 실행될 수 있는 코드를 포함시킬 수 있습니다.

### 예시: 악의적 조작된 바이트 스트림을 통한 RCE

1. **악의적 조작된 바이트 스트림 생성**: 공격자는 애플리케이션에 악의적 조작된 바이트 스트림을 전송합니다. 이 바이트 스트림은 역직렬화 과정에서 실행될 수 있는 코드를 포함하고 있습니다.

2. **역직렬화 과정**: 애플리케이션은 이 바이트 스트림을 받아 역직렬화 과정을 거칩니다. 역직렬화 과정에서 바이트 스트림은 Java 객체로 복원되며, 이 과정에서 악의적 조작된 바이트 스트림에 포함된 코드가 실행될 수 있습니다. 가령 `MaliciousObject` 클래스의 인스턴스가 생성되고, 이 때 생성자의 코드가 실행됩니다.

3. **원격 코드 실행**: 악의적 조작된 바이트 스트림에 포함된 코드가 실행되면, 공격자는 서버에서 임의의 코드를 실행할 수 있게 됩니다. 이는 서버의 파일 시스템에 접근하거나, 다른 시스템으로의 공격을 위한 악성 코드를 설치하는 등의 작업을 수행할 수 있습니다.

악의적 조작된 바이트 스트림은 역직렬화 과정에서 실행될 수 있는 코드를 포함할 수 있습니다. 예를 들어, 공격자는 다음과 같은 코드를 포함하는 객체를 생성하고, 이를 바이트 스트림으로 변환할 수 있습니다.

```java
import java.io.Serializable;

public class MaliciousClass implements Serializable {
    private static final long serialVersionUID = 1L;

    private void readObject(java.io.ObjectInputStream in) throws java.io.IOException, ClassNotFoundException {
        // 역직렬화 과정에서 실행될 코드
        System.out.println("This is a malicious code executed during deserialization.");
    }
}
```

```java
public class MaliciousObject implements Serializable {
    private static final long serialVersionUID = 1L;

    public MaliciousObject() {
        // 생성자에서 악의적인 코드를 실행합니다.
        System.out.println("Malicious code executed!");
        // 또는, 더 심각한 작업을 수행하는 코드를 여기에 추가할 수 있습니다.
    }
}
```

이 `MaliciousObject` 클래스는 `Serializable` 인터페이스를 구현하고 있으며, 생성자에서 악의적인 코드를 실행합니다. 이 객체를 바이트 스트림으로 변환하고, 이 바이트 스트림을 역직렬화하는 과정에서 생성자의 코드가 실행됩니다.

## 대응 방안

이러한 위협을 방지하기 위해, 신뢰할 수 없는 데이터로부터의 역직렬화를 피하고, 가능한 경우 대안 컴포넌트를 사용하는 것이 중요합니다. 또한, 최신 버전의 라이브러리나 프레임워크를 사용하고, 보안 패치를 적용하는 것도 중요한 대응 방안입니다.

Spring Framework는 이 문제를 해결하기 위해 여러 조치를 취했습니다. 버전 4.2.6과 3.2.17에서는 사용자가 안전하지 않은 Java 역직렬화에 대해 주의를 기울일 수 있도록 문서를 개선했으며, 버전 5.3.0에서는 영향을 받는 클래스를 사용하지 않도록 권장하고, 버전 6.0.0에서는 해당 클래스를 완전히 제거했습니다. 따라서, 이 취약점에 대한 가장 좋은 대응 방안은 영향을 받는 버전을 사용하고 있다면 가능한 빨리 최신 버전으로 업데이트하는 것입니다. 또한, 신뢰할 수 없는 데이터로부터의 역직렬화를 피하고, 가능한 경우 대안 컴포넌트를 사용하는 것도 고려해볼 수 있습니다.
